name: Lint Commits

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  commitlint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Install Commitlint
        run: |
          npm install --save-dev @commitlint/{config-conventional,cli}

      - name: Run Commitlint (skip "initial commit")
        run: |
          # Collect commit SHAs in the PR range
          COMMITS=$(git log --format=%H ${{ github.event.pull_request.base.ref }}..HEAD)

          for COMMIT in $COMMITS; do
            MESSAGE=$(git log -1 --pretty=format:%s $COMMIT)

            if echo "$MESSAGE" | grep -iq "initial commit"; then
              echo "‚úÖ Skipping commit $COMMIT ('$MESSAGE')"
              continue
            fi

            echo "üîç Checking commit $COMMIT ('$MESSAGE')"
            echo "$COMMIT" | npx commitlint
          done
